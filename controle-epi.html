<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle de EPIs</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .card { margin-bottom: 1.5rem; }
        /* Estilo para a logo */
        .header-logo {
            max-width: 250px; /* Ajuste o tamanho do logo aqui */
            height: auto;
            display: block; 
            margin: 20px auto; /* Centraliza a imagem e adiciona espaço */
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        
        <img src="Logo_Direcional_.png" alt="Logo da Empresa" class="header-logo">
        
        <h1 class="text-center mb-4">Controle de Uso de EPIs</h1>
        
        <div class="card">
            <div class="card-header">
                <strong>Registrar Novo Uso</strong>
            </div>
            <div class="card-body">
                <div class="row align-items-end g-3">
                    <div class="col-md-4">
                        <label for="tipo-epi" class="form-label">Tipo de EPI</label>
                        <select id="tipo-epi" class="form-select"></select>
                    </div>
                    <div class="col-md-3">
                        <label for="data" class="form-label">Data</label>
                        <input type="date" id="data" class="form-control">
                    </div>
                    <div class="col-md-3">
                        <label for="quantidade" class="form-label">Quantidade</label>
                        <input type="number" id="quantidade" class="form-control" min="1" placeholder="Ex: 50">
                    </div>
                    <div class="col-md-2">
                        <button onclick="salvarRegistro()" class="btn btn-primary w-100">Adicionar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <strong>Relatório Geral de Consumo (Semana de Segunda a Sábado)</strong>
            </div>
            <div class="card-body">
                <table class="table table-bordered text-center">
                    <thead class="table-light">
                        <tr>
                            <th>Tipo de EPI</th>
                            <th>Total no Mês</th>
                            <th>Total na Semana</th>
                            <th>Total Hoje</th>
                        </tr>
                    </thead>
                    <tbody id="relatorio-tabela">
                        </tbody>
                </table>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <strong>Histórico de Lançamentos</strong>
            </div>
            <div class="card-body">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Tipo de EPI</th>
                            <th>Quantidade</th>
                            <th>Ação</th>
                        </tr>
                    </thead>
                    <tbody id="historico-tabela">
                        </tbody>
                </table>
            </div>
        </div>
        
        <div class="text-center mt-3 mb-5">
            <button onclick="limparDados()" class="btn btn-danger">Limpar Todos os Dados</button>
        </div>
    </div>
     <h4>Por: Alrilânio Pinheiro</h4>
    <script>
        // --- CONFIGURAÇÃO ---
        const LISTA_EPIS = [
            'LUVA DE MALHA', 'LUVA NITRÍLICA', 'CAPACETE', 'BOTINA DE SEGURANÇA',
            'ÓCULOS ESCUROS', 'ÓCULOS INCOLOR', 'PROTETOR CONCHA', 'PROTETOR PLUG',
            'TOUCA ÁRABE', 'CARNEIRA', 'CALÇA BRIM AMARELO', 'CAMISA BRIM AMARELO'
        ].sort();

        const SENHA_MESTRE = 'alri123';

        // --- LÓGICA DO SISTEMA ---

        function popularSelectEPI() {
            const selectEPI = document.getElementById('tipo-epi');
            LISTA_EPIS.forEach(epi => {
                const option = document.createElement('option');
                option.value = epi;
                option.textContent = epi;
                selectEPI.appendChild(option);
            });
        }
        
        document.getElementById('data').valueAsDate = new Date();

        function salvarRegistro() {
            const epiInput = document.getElementById('tipo-epi').value;
            const dataInput = document.getElementById('data').value;
            const quantidadeInput = document.getElementById('quantidade').value;

            if (!epiInput || !dataInput || !quantidadeInput || parseInt(quantidadeInput) <= 0) {
                alert('Por favor, preencha todos os campos com valores válidos.');
                return;
            }

            const dataSelecionada = new Date(dataInput + 'T00:00:00');
            if (dataSelecionada.getDay() === 0) {
                alert('Não é permitido fazer lançamentos aos domingos.');
                return;
            }

            const novoRegistro = {
                id: Date.now(),
                data: dataInput,
                epi: epiInput,
                quantidade: parseInt(quantidadeInput)
            };

            let registros = JSON.parse(localStorage.getItem('registrosEPIs')) || [];
            registros.push(novoRegistro);
            localStorage.setItem('registrosEPIs', JSON.stringify(registros));

            document.getElementById('quantidade').value = '';
            atualizarTudo();
        }

        function excluirRegistro(id) {
            const senhaInserida = prompt("Para excluir, digite a senha de administrador:");
            if (senhaInserida === null) return;

            if (senhaInserida === SENHA_MESTRE) {
                let registros = JSON.parse(localStorage.getItem('registrosEPIs')) || [];
                const registrosAtualizados = registros.filter(registro => registro.id !== id);
                localStorage.setItem('registrosEPIs', JSON.stringify(registrosAtualizados));
                atualizarTudo();
                alert("Registro excluído com sucesso!");
            } else {
                alert("Senha incorreta. A exclusão foi cancelada.");
            }
        }

        function gerarRelatorio() {
            const registros = JSON.parse(localStorage.getItem('registrosEPIs')) || [];
            
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);

            const diaDaSemana = hoje.getDay();
            const diff = hoje.getDate() - diaDaSemana + (diaDaSemana === 0 ? -6 : 1);
            const inicioDaSemana = new Date(hoje.setDate(diff));
            inicioDaSemana.setHours(0, 0, 0, 0);
            
            const inicioDoMes = new Date(new Date().getFullYear(), new Date().getMonth(), 1);

            let totais = {};
            LISTA_EPIS.forEach(epi => {
                totais[epi] = { hoje: 0, semana: 0, mes: 0 };
            });

            for (const registro of registros) {
                const dataRegistro = new Date(registro.data + 'T00:00:00');
                
                if (!totais[registro.epi]) continue;

                if (dataRegistro >= inicioDoMes) {
                    totais[registro.epi].mes += registro.quantidade;
                }
                if (dataRegistro >= inicioDaSemana) {
                    totais[registro.epi].semana += registro.quantidade;
                }
                if (dataRegistro.getTime() === hoje.getTime()) {
                    totais[registro.epi].hoje += registro.quantidade;
                }
            }

            const relatorioCorpo = document.getElementById('relatorio-tabela');
            relatorioCorpo.innerHTML = '';
            for (const epi of LISTA_EPIS) {
                const linha = `<tr>
                                <td><strong>${epi}</strong></td>
                                <td>${totais[epi].mes}</td>
                                <td>${totais[epi].semana}</td>
                                <td>${totais[epi].hoje}</td>
                               </tr>`;
                relatorioCorpo.innerHTML += linha;
            }
        }

        function exibirHistorico() {
            const registros = JSON.parse(localStorage.getItem('registrosEPIs')) || [];
            const tabelaCorpo = document.getElementById('historico-tabela');
            tabelaCorpo.innerHTML = '';

            registros.sort((a, b) => new Date(b.data) - new Date(a.data));

            registros.forEach(registro => {
                const dataFormatada = new Date(registro.data + 'T00:00:00').toLocaleDateString('pt-BR');
                const linha = `<tr>
                                <td>${dataFormatada}</td>
                                <td>${registro.epi}</td>
                                <td>${registro.quantidade}</td>
                                <td>
                                    <button class="btn btn-danger btn-sm" onclick="excluirRegistro(${registro.id})">
                                        Excluir
                                    </button>
                                </td>
                               </tr>`;
                tabelaCorpo.innerHTML += linha;
            });
        }
        
        function limparDados() {
            const senhaInserida = prompt("Para limpar todos os dados, digite a senha de administrador:");
            
            if (senhaInserida === null) return;
            
            if (senhaInserida === SENHA_MESTRE) {
                 if (confirm('ATENÇÃO!\n\nIsso apagará permanentemente todo o histórico de registros.\nDeseja continuar?')) {
                    localStorage.removeItem('registrosEPIs');
                    atualizarTudo();
                    alert("Todos os dados foram apagados.");
                }
            } else {
                alert("Senha incorreta. Operação cancelada.");
            }
        }

        function atualizarTudo() {
            gerarRelatorio();
            exibirHistorico();
        }

        document.addEventListener('DOMContentLoaded', () => {
            popularSelectEPI();
            atualizarTudo();
        });

    </script>
</body>
</html>